#!/bin/bash
# author : tclauzel
# description : nmap script for subnet scanning and discover common services
# Version : 1
echo -e "
\e[32m
▄▄▄█████▓ █    ██  ██▀███   ▄▄▄▄    ▒█████   ███▄    █  ███▄ ▄███▓ ▄▄▄       ██▓███
▓  ██▒ ▓▒ ██  ▓██▒▓██ ▒ ██▒▓█████▄ ▒██▒  ██▒ ██ ▀█   █ ▓██▒▀█▀ ██▒▒████▄    ▓██░  ██▒
▒ ▓██░ ▒░▓██  ▒██░▓██ ░▄█ ▒▒██▒ ▄██▒██░  ██▒▓██  ▀█ ██▒▓██    ▓██░▒██  ▀█▄  ▓██░ ██▓▒
░ ▓██▓ ░ ▓▓█  ░██░▒██▀▀█▄  ▒██░█▀  ▒██   ██░▓██▒  ▐▌██▒▒██    ▒██ ░██▄▄▄▄██ ▒██▄█▓▒ ▒
  ▒██▒ ░ ▒▒█████▓ ░██▓ ▒██▒░▓█  ▀█▓░ ████▓▒░▒██░   ▓██░▒██▒   ░██▒ ▓█   ▓██▒▒██▒ ░  ░
  ▒ ░░   ░▒▓▒ ▒ ▒ ░ ▒▓ ░▒▓░░▒▓███▀▒░ ▒░▒░▒░ ░ ▒░   ▒ ▒ ░ ▒░   ░  ░ ▒▒   ▓▒█░▒▓▒░ ░  ░
    ░    ░░▒░ ░ ░   ░▒ ░ ▒░▒░▒   ░   ░ ▒ ▒░ ░ ░░   ░ ▒░░  ░      ░  ▒   ▒▒ ░░▒ ░
  ░       ░░░ ░ ░   ░░   ░  ░    ░ ░ ░ ░ ▒     ░   ░ ░ ░      ░     ░   ▒   ░░
            ░        ░      ░          ░ ░           ░        ░         ░  ░
\033[0m                                 ░
"
echo "What range do you want to scan ? X.X.X.X/24 "
read range
ScanService(){
    nmap -sS -O -p $1 $range > $1.txt
    grep -B 4 open $1.txt >> $1_open.txt
    grep -E -o "([0-9]{1,3}[\.]){3}[0-9]{1,3}" $1_open.txt > $1_open_list.log
    rm *.txt
    result=$(cat $1_open_list.log)
    return 0
}
echo "Scanning services ..."
cat common_ports.log |  while read output
do
    echo "checking for $output ..."
    ScanService $output
done
echo ""
echo "Results of scan : "
echo ""
cat common_ports.log |  while read output
do
    logsize=$(du -h "$output"_open_list.log 2>/dev/null | cut -f 1)
    logfile="$output"_open_list.log
    if [ $logsize = "0" 2>/dev/null ]
    then
      rm "$output"_open_list.log
    else
      if [ -f $logfile ];then
      echo -e "\e[32m------------------------------------------------\033[0m"
      echo "Exposed host with port $output open : "
      cat "$output"_open_list.log 2>/dev/null
      echo -e "\e[32m------------------------------------------------\033[0m"
      echo ""
      fi
    fi
done
echo "done !"
